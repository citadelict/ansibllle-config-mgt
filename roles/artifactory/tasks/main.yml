---
# tasks file for installing Artifactory

- name: Update Ubuntu OS
  ansible.builtin.apt:
    update_cache: yes

- name: Add JFrog Artifactory APT repository
  ansible.builtin.copy:
    content: "deb https://releases.jfrog.io/artifactory/artifactory-debs xenial main"
    dest: /etc/apt/sources.list.d/artifactory.list

- name: Import repository GPG key
  ansible.builtin.command:
    cmd: "curl -fsSL https://releases.jfrog.io/artifactory/api/gpg/key/public | gpg --dearmor -o /etc/apt/trusted.gpg.d/artifactory.gpg"

- name: Update the package list
  ansible.builtin.apt:
    update_cache: yes

- name: Install Artifactory
  ansible.builtin.apt:
    name: jfrog-artifactory-oss
    state: present

- name: Start Artifactory service
  ansible.builtin.systemd:
    name: artifactory.service
    state: started

- name: Enable Artifactory service
  ansible.builtin.systemd:
    name: artifactory.service
    enabled: yes

- name: Check Artifactory service status
  ansible.builtin.systemd:
    name: artifactory.service
    register: artifactory_status

- name: Ensure Artifactory is running
  ansible.builtin.debug:
    msg: "Artifactory is installed and running"
  when: artifactory_status.status.ActiveState == "active"
